define("lib",function(require,exports,module){var $=require("jquery");var dialog=require("dialog");var md5=require("md5");require("hidySdk");exports.getParam=getParam;exports.getParam2=getParam2;exports.setParam=setParam;exports.setParam2=setParam2;exports.removeParam=removeParam;exports.post=post;exports.get=get;exports.getLocalData=getLocalData;exports.setLocalData=setLocalData;exports.getCookie=getCookie;exports.setTimeout=_setTimeout;exports.setInterval=_setInterval;exports.setNoCache=setNoCache;exports.redirect=redirect;exports.redirect2=redirect2;exports.redirectClient=redirectClient;exports.onNavBtnClick=onNavBtnClick;exports.onPageDestory=onPageDestory;exports.historyBack=historyBack;BDY.historyBack=historyBack;exports.openUrl=openUrl;exports.showTip=showTip;exports.showErrorTip=showErrorTip;exports.showDialog=showDialog;exports.showLoading=showLoading;exports.hideLoading=hideLoading;exports.confirm=_confirm;exports.closeWebView=closeWebView;exports.closeAllWebView=closeAllWebView;exports.setTitle=setTitle;exports.openLogin=openLogin;exports.checkWXAgent=checkWXAgent;exports.checkLogin=checkLogin;exports.reportEvent=reportEvent;exports.hmtTrackPage=hmtTrackPage;exports.hmtCustomVar=hmtCustomVar;exports.hmtTrackEvent=hmtTrackEvent;exports.init=init;var isInit=true;var isForward=true;var loadDialog;var HiydSdk=window.HiydSdk||null;function getParam(name){var str=document.location.hash.substr(2);var value=getParam2(name,str);if(value==null){str=document.location.search.substr(1);value=getParam2(name,str)}return value}function getParam2(name,str){var reg=new RegExp("(^|!|&)"+name+"=([^&]*)(&|$)");r=str.match(reg);if(r!=null){try{return decodeURIComponent(r[2])}catch(e){console.log(e+"r[2]:"+r[2]);return null}}return null}function setParam(name,value,causeHistory){var hash=document.location.hash.substr(2);if($.type(name)==="object"){causeHistory=value;value=name;for(var key in value){hash=setParam2(key,value[key],hash)}}else{hash=setParam2(name,value,hash)}if(causeHistory){document.location.hash="!"+hash}else{if(history.replaceState){history.replaceState({},null,"#!"+hash)}else{console.error("history.replaceState:"+history.replaceState)}}}function setParam2(name,value,str){if($.type(name)==="object"){str=value;value=name;for(var key in value){str=setParam2(key,value[key],str)}return str}else{var prefix=str?"&":"";var reg=new RegExp("(^|!|&)"+name+"=([^&]*)(&|$)");r=str.match(reg);if(r){if(r[2]){var newValue=r[0].replace(r[2],value);str=str.replace(r[0],newValue)}else{var newValue=prefix+name+"="+value+"&";str=str.replace(r[0],newValue)}}else{var newValue=prefix+name+"="+value;str+=newValue}return str}}function removeParam(name,causeHistory){var hash=document.location.hash.substr(2);var reg=new RegExp("(^|!|&)"+name+"=([^&]*)(&|$)");r=hash.match(reg);if(r){hash=hash.replace(r[0],"&")}if(causeHistory){document.location.hash="!"+hash}else{if(history.replaceState){history.replaceState({},null,"#!"+hash)}else{console.error("history.replaceState:"+history.replaceState)}}}function parseHash(strUrl){strUrl=strUrl?strUrl:document.location.hash.substr(2);var reg=new RegExp("(^|!|#|&)(\\w*)=([^&]*)","g");var r=reg.exec(strUrl);var datas={};var i=0;while(r!=null){datas[r[2]]=decodeURIComponent(r[3]);r=reg.exec(strUrl)}return datas}function _getDefaultData(data){data=data||{};var defaultKeys=["session_id","user_id","otoken","uid"];for(var i in defaultKeys){var value=getLocalData(defaultKeys[i]);if(value&&value!="undefined"){data[defaultKeys[i]]=value}}for(var k in data){var v=data[k];if(v==null||typeof v==="undefined"){delete data[k]}else{if(typeof v==="string"){data[k]=$.trim(v)}}}return data}function post(url,data,callback,option){option=option||{};if(typeof data=="function"){option=callback||{};callback=data;data={}}data=_getDefaultData(data);if(window.KLCommon&&KLCommon.post){KLCommon.post(url,data,function(objResult){_handleResult(callback,objResult)},option)}else{var xhr=new XMLHttpRequest;xhr.open("POST",url);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.withCredentials=true;if(window.KalaGame){xhr.setRequestHeader("Cache-Control","no-cache")}data["_from"]="ajax";data=$.param(data);if(option["cache"]){var cacheKey="ajaxCache-"+url+"?"+data;var isCached=_loadAjaxCache(cacheKey,callback);if(isCached){option["loading"]=false;if(option["cache"]=="must"){return}}}if(option["loading"]){xhr.timeout=15e3;showLoading()}xhr.send(data);xhr.ontimeout=option["onTimeout"];xhr.onload=function(){option["loading"]&&hideLoading();var objResult=_getAjaxResult(xhr.responseText);if(objResult["result"]&&option["cache"]){var cache=localStorage.getItem(cacheKey);if(cache&&cache==xhr.responseText){return}else{localStorage.setItem(cacheKey,xhr.responseText)}}_handleResult(callback,objResult)}}}function get(url,data,callback,option){option=option||{};if(typeof data=="function"){option=callback||{};callback=data;data={}}if(window.KLCommon&&KLCommon.get){KLCommon.get(url,callback,option)}else{var xhr=new XMLHttpRequest;xhr.url=url;if(/#|\?/.test(url)){url+="&_from=ajax"}else{url+="?_from=ajax"}option["loading"]&&showLoading();xhr.onreadystatechange=function(){if(xhr.readyState!=4){return}if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&location.protocol=="file:"){option["loading"]&&hideLoading();callback(xhr.responseText)}};if(option["timeout"]){xhr.timeout=option["timeout"]}xhr.ontimeout=option["onTimeout"];xhr.open("GET",url);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send()}}function _getAjaxResult(text){var objResult={};var objError={result:0,msg:"系统繁忙，请稍后再试！"};try{objResult=JSON.parse(text);if(typeof objResult!=="object"||objResult===null){objResult=objError}}catch(ex){objResult=objError}return objResult}function _loadAjaxCache(cacheKey,callback){var cache=localStorage.getItem(cacheKey);if(cache){var objResult=JSON.parse(cache);objResult._fromCache=true;_handleResult(callback,objResult);return true}else{return false}}function _handleResult(callback,objResult){if(!objResult.result&&objResult.code==-5){openLogin()}else{callback&&callback(objResult)}}function _deserialize(value){if(typeof value!="string"){return undefined}try{return JSON.parse(value)}catch(e){return value||undefined}}function getCookie(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg))return decodeURIComponent(arr[2]);else return null}function getLocalData(key){return getParam(key)||_deserialize(localStorage.getItem(key))}function setLocalData(key,val){localStorage.setItem(key,JSON.stringify(val))}function _setTimeout(callback,timeout){var timer=setTimeout(callback,timeout);BDY.timeout.push(timer);return timer}function _setInterval(callback,timeout){var timer=setInterval(callback,timeout);BDY.interval.push(timer);return timer}function _clearTimer(){var len;var timeout=BDY.timeout;var interval=BDY.interval;len=timeout.length;for(var i=0;i<len;i++){clearTimeout(timeout[i])}len=interval.length;for(var i=0;i<len;i++){clearInterval(interval[i])}BDY.timeout=[];BDY.interval=[]}var pages={},oldPage,noCachePages={};function init(){if(!document.body){setTimeout(init,10);console.warn("webview is slow, setTimeout(init, 10)")}_initEvent();_initUrl();var page=location.href.replace("http://"+location.host,"");$("#container").attr("data-page",page);$(".o-hiyd-header").css("position","fixed");checkLogin(toggleUserInfo);var $links=$("#container").find("link");$links.each(function(){_moveCss(this)});if(window.Hiyd&&Object.keys(window.Hiyd).length>0){$(".oh5-wrap").addClass("hiyd-app")}_initNetworkType()}function setNoCache(url){url=url||location.href;url=url.replace("http://"+location.host,"");noCachePages[url]=1}function _initEvent(){$("body").off(BDY.click+".data-href").on(BDY.click+".data-href","[data-href]",function(){var $this=$(this);var href=$this.attr("data-href")||$this.attr("href");var gym_id=getParam("gym_id");if(gym_id&&href.indexOf("gym_id=")==-1){var connect=href.indexOf("?")==-1?"?":"&";href+=connect+"gym_id="+gym_id}var clientParam=$this.attr("data-client");var replace=$this.attr("data-replace");if(clientParam!=null){redirectClient(href,clientParam)}else if(replace!=null){redirect2(href)}else{redirect(href)}return false});$("body").off(BDY.click+".data-report").on(BDY.click+".data-report","[data-report]",function(){var $this=$(this);var page=$("[report-page]").attr("report-page")||document.title;var event="click_"+$this.attr("report-name");hmtTrackEvent(page,event,"","")});$("body").off(BDY.click+".data-loader").on(BDY.click+".data-href","#hiyd_loader .list-more",function(){var url=$(this).attr("href");$(this).parent().html('<div class="list-loading"></div>');var connect=url.indexOf("?")>=0?"&":"?";url+=connect+"_loader=1";get(url,function(html){$("#hiyd_loader").replaceWith(html)},{timeout:15e3,onTimeout:function(){alert("超时了，请重试")}});return false});$("body").on("click",".o-hiyd-header .btn.return",function(){if(history&&history.length>1){history.back()}else{redirect2("/")}});window.onpopstate=function(event){var oldPage=$("#container").attr("data-page");var newPage=location.href.replace("http://"+location.host,"");if(oldPage!=newPage){_redirectPage(newPage)}};_initActiveEvent()}function _initActiveEvent(){var selector="input[type='submit'], [data-active]";var $elem,$activeElem;var timeHandler=0;var LONG_TAP_TIME=500;$(document).off(BDY.touchstart+".body").on(BDY.touchstart+".body",function(e){$elem=$(e.target);$activeElem=$elem;if(!$activeElem.filter(selector).length){$activeElem=$activeElem.parents(selector)}var activeStyle=$activeElem.attr("data-active")||"active";$activeElem.addClass(activeStyle);timeHandler=_setTimeout(function(){$elem&&$elem.trigger("longTap");_removeActive()},LONG_TAP_TIME)});$(document).off("touchmove.body").on("touchmove.body",selector,function(event){clearTimeout(timeHandler);timeHandler=0;_removeActive();$elem=null});$(document).off("mouseout.body").on("mouseout.body",selector,function(event){_removeActive();$elem=null});var lastTime=0;$(document).off(BDY.touchend+".body").on(BDY.touchend+".body",function(e){clearTimeout(timeHandler);timeHandler=0;if($elem){var currentTime=(new Date).getTime();var duration=currentTime-lastTime;var MIN_TRIGGER_INTERVAL=300;if(duration>MIN_TRIGGER_INTERVAL){$elem.trigger("touchclick");lastTime=currentTime}}_removeActive()});$(document).off("scroll.body").on("scroll.body",_removeActive);function _removeActive(){if($activeElem!=null){var activeStyle=$activeElem.attr("data-active")||"active";$activeElem.blur();$activeElem.removeClass(activeStyle);$activeElem=null}$elem=null}["longTap","touchclick"].forEach(function(m){$.fn[m]=function(callback){return this.on(m,callback)}})}function _initUrl(){var env="product";if(/test\.|webdev\./.test(location.host)){env="test"}else if(/new\./.test(location.host)){env="new"}switch(env){case"test":exports.pcUrl="https://test.www.hiyd.com/";exports.mobiUrl="https://test.m.hiyd.com/";exports.mMealsUrl="http://test.m.meals.hiyd.com/";break;case"new":exports.pcUrl="https://new.www.hiyd.com/";exports.mobiUrl="https://new.m.hiyd.com/";exports.mMealsUrl="http://new.m.meals.hiyd.com/";break;default:exports.pcUrl="https://www.hiyd.com/";exports.mobiUrl="https://m.hiyd.com/";exports.mobiUrl="https://m.hiyd.com/";exports.mMealsUrl="http://m.meals.hiyd.com/";break}}function historyBack(){var curPage=$("#container").attr("data-page");pages[curPage]=pages[curPage]||{};pages[curPage]["scrollTop"]=0;if(!HiydSdk||!HiydSdk.historyBack()){history.back()}}function redirect(url){if(location.href.match("channel=bd")){url+=/#|\?/.test(url)?"&channel=bd":"?channel=bd"}if(location.href.match("channel=box")){url+=/#|\?/.test(url)?"&channel=box":"?channel=box"}oldPage=$("#container").attr("data-page");pages[oldPage]=pages[oldPage]||{};pages[oldPage]["scrollTop"]=_getScrollTop();isForward=true;history.pushState({},"",url);_redirectPage(url)}function redirect2(url){oldPage=$("#container").attr("data-page");pages[oldPage]=pages[oldPage]||{};pages[oldPage]["scrollTop"]=_getScrollTop();isForward=true;history.replaceState({},"",url);_redirectPage(url)}function _getScrollTop(){return document.documentElement.scrollTop||document.body&&document.body.scrollTop}function redirectClient(param,clientParam){oldPage=$("#container").attr("data-page");var values=parseHash(param);if(window.Ouj){var search=document.location.search;search=setParam2(values,search);if(clientParam){values=parseHash(clientParam);search=setParam2(values,search)}HiydSdk.openUrl(location.origin+location.pathname+search)}else{pages[oldPage]=pages[oldPage]||{};pages[oldPage]["scrollTop"]=_getScrollTop();isForward=true;setParam(values,true)}}function openUrl(url,title,needTopBar){if(window.DuowanUi&&DuowanUi.openUrl){DuowanUi.openUrl(url,title,needTopBar)}else{window.open(url)}}function closeWebView(){if(!HiydSdk||!HiydSdk.closeWebView()){historyBack()}}function closeAllWebView(){if(!HiydSdk||!HiydSdk.closeAllWebView()){historyBack()}}function _redirectPage(_page){_page=_page.replace("http://"+location.host,"");pages[_page]=pages[_page]||{};if(!pages[_page]["dom"]){_getNewPage(_page)}else{_changePage(_page)}}function _getNewPage(_page,option){get(_page,function(responseText){pages[_page]["dom"]=responseText;_changePage(_page,option)},{loading:false,cache:true})}function _moveCss(link){var flag=false;var $links=$("head").find("link");for(var i=0;i<$links.length;i++){if($links[i].href.indexOf(link.href)>=0){flag=true}}if(!flag){$("head").append(link)}else{$(link).remove()}}function _changePage(_page){var $pageswarp=$("#container");var $page=$pageswarp.children();$(window).off("scroll");if(oldPage&&$page.length&&!noCachePages[oldPage]){pages[oldPage]=pages[oldPage]||{};pages[oldPage]["script"]=$page.filter("script");pages[oldPage]["destory"]&&pages[oldPage]["destory"].call();var $fragment=$(document.createDocumentFragment());pages[oldPage]["dom"]=$fragment.append($page.filter(":not(script)"));_clearTimer()}_renderPage(_page);hmtTrackPage(document.location.href);hmtCustomVar(1,"oujWapPage",_page,1);$(document).trigger(BDY.pageChange,_page);oldPage=_page}function _renderPage(_page){var $pageswarp=$("#container");try{var dom=pages[_page]["dom"];if(typeof dom=="string"){$pageswarp.html(dom);scroll(0,0);setTimeout(function(){var $links=$pageswarp.find("link");$links.each(function(){_moveCss(this)})},10)}else{var scrollTop=pages[_page]["scrollTop"];$pageswarp.html(dom);scroll(0,scrollTop);var script=pages[_page]["script"];script&&$pageswarp.append(script)}checkLogin(toggleUserInfo);$pageswarp.attr("data-page",_page);$(".oh5-wrap").get(0).clientLeft;var $config=$("#config");var pageConfig={};if($config.length){pageConfig=$config.html().trim();pageConfig=JSON.parse(pageConfig)}var $config2=$("#config2");if($config2.length){var pageConfig2=$config2.html().trim();pageConfig2=JSON.parse(pageConfig2);for(var key in pageConfig2){pageConfig[key]=pageConfig[key]||pageConfig2[key]}}pageConfig.title&&setTitle(pageConfig.title)}catch(e){if(seajs.data&&seajs.data.debug){throw e}else{console.error(e)}}}function onPageDestory(callback){var _p=$("#container").attr("data-page");if(callback){pages[_p]=pages[_p]||{};pages[_p]["destory"]=callback}}function onNavBtnClick(callback){$(document).on(BDY.navBtnClick+"_"+getParam("page"),callback)}var loadingDelayHandler=0;var loadingTimeoutHandler=0;function showLoading(text,timeout,cancelable,delay){timeout=timeout||15e3;delay=delay||500;if(cancelable==null){cancelable=true}else{cancelable=!!cancelable}if(loadingDelayHandler){return}loadingDelayHandler=setTimeout(function(){if(!HiydSdk||!HiydSdk.showLoading(text,timeout,cancelable)){loadDialog=dialog().showModal();loadingTimeoutHandler=setTimeout(function(){hideLoading();showTip("加载超时，请稍后再试")},timeout);$(".ui-popup-backdrop").on(BDY.click,function(){loadDialog&&loadDialog.close().remove();loadDialog=null})}},delay)}function hideLoading(){loadingDelayHandler&&clearTimeout(loadingDelayHandler);loadingDelayHandler=0;loadingTimeoutHandler&&clearTimeout(loadingTimeoutHandler);loadingTimeoutHandler=0;if(!HiydSdk||!HiydSdk.hideLoading()){loadDialog&&loadDialog.close().remove();loadDialog=null}}function showErrorTip(msg,timeout){if(!msg){return}timeout=timeout||3e3;if(!HiydSdk||!HiydSdk.showErrorTip(msg,timeout)){var d=dialog({content:msg}).showModal();setTimeout(function(){d.close().remove()},timeout)}}function showTip(msg,timeout){if(!msg){return}timeout=timeout||2e3;if(!HiydSdk||!HiydSdk.showTip(msg,timeout)){var d=dialog({content:msg}).width(window.innerWidth*.75).showModal();setTimeout(function(){d.close().remove()},timeout);$(".ui-popup-backdrop").on(BDY.click,function(){try{d.close().remove()}catch(e){}})}}function toggleUserInfo(flag){if(flag){$(".oh5-header_user").hide();var userName=getCookie("ousername");$(".oh5-header_userInfo .userName").text(userName);$(".oh5-header_userInfo .userLogout").off(BDY.click).on(BDY.click,function(){logout()});$(".oh5-header_userInfo").show()}else{$(".oh5-header_user").show();$(".oh5-header_userInfo").hide()}}function checkWXAgent(){var ua=navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}}function checkLogin(callback){var isLogin=!getCookie("ouid")&&!getCookie("otoken");if(callback){callback(!isLogin)}else{return!isLogin}}function tryAutoLogin(){if(window.Hiyd){return HiydSdk.openLogin()}else{return false}var fromUrl=document.location.href;var url=exports.pcUrl+api+"?url="+encodeURIComponent(fromUrl);post(url,function(objResult){if(!objResult.result){if(objResult.data){location.href=objResult.data}else{showTip(objResult.msg)}}else{location.reload()}});return true}function logout(){var time=new Date;time.setTime(time.getTime()-1*864e5);time=time.toUTCString();post(exports.pcUrl+"user/logout");var domain=/ouj.com/.test(document.location.href)?"domain=ouj.com":"domain="+document.domain;document.cookie="appid=; expires="+time+"; path=/;"+domain;document.cookie="otoken=; expires="+time+"; path=/;"+domain;document.cookie="ouid=; expires="+time+"; path=/;"+domain;document.cookie="ouj_token=; expires="+time+"; path=/;";document.location.reload()}function openLogin(){var flag=tryAutoLogin();if(!flag){var fromUrl=encodeURIComponent(document.location.href);_setTimeout(function(){var url=exports.mobiUrl+"user/login/?fromUrl="+fromUrl;document.location.replace(url)},300);return false}}function showDialog(msg,callback,title,buttonLabels){title=title||"提示";buttonLabels=buttonLabels||"确定";var d=dialog({title:title,content:msg,skin:"weui-dialog",okValue:buttonLabels,ok:function(){callback&&callback(true);d.close().remove()}});d.width(window.innerWidth*.75).showModal()}function _confirm(msg,callback,title,buttonLabels){title=title||"提示";buttonLabels=buttonLabels||"确定,取消";if(!HiydSdk.confirm(msg,callback,title,buttonLabels)||!HiydSdk.confirm(msg,callback,title,buttonLabels)){var d=dialog({title:title,content:msg,skin:"weui-dialog",okValue:buttonLabels.split(",")[0],ok:function(){callback&&callback(true);d.close().remove()},cancelValue:buttonLabels.split(",")[1],cancel:function(){callback&&callback(false);d.close().remove()}});d.width(window.innerWidth*.75).showModal()}}function setTitle(title){document.title=title;if(window.HiydSdk&&HiydSdk.setTitle){HiydSdk.setTitle(title)}}function checkWXAgent(){var ua=navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}}function getSortParam(obj){var keyArr=new Array;for(var a in obj){keyArr.push(a)}keyArr.sort();keySign="";for(var i=0;i<keyArr.length;i++){keySign+=(i==0?"":"&")+keyArr[i]+"="+encodeURIComponent(obj[keyArr[i]])}return keySign}function reportEvent(page,action,params){var param={sysOS:"Web",page:page,action:action,params:params,eventTime:(new Date).getTime()};var reportUrl=exports.pcUrl+"data/event?"+$.param(param);var rp=new Image(1,1);rp.src=reportUrl}function reportError(page,error){var param={page:page,error:error};var reportUrl=exports.pcUrl+"data/error?"+$.param(param);var rp=new Image(1,1);rp.src=reportUrl}function hmtTrackPage(pageURL){try{_hmt.push(["_trackPageview",pageURL])}catch(e){}}function hmtCustomVar(index,name,value,opt_scope){try{_hmt.push(["_setCustomVar",index,name,value,opt_scope])}catch(e){}}function hmtTrackEvent(category,action,opt_label,opt_value){try{_hmt.push(["_trackEvent",category,action,opt_label,opt_value]);reportError(action,opt_value)}catch(e){}}function _reportError(msg,url,line){var txt="Error: "+msg+"\n";txt+="Line: "+line+"\n\n";txt+="URL: "+url+"\n";hmtTrackEvent("error",location.href,"",txt);console.error(txt);return true}function _initToolsForm(){var unifo=JSON.parse(localStorage.getItem("unifo"));if(!unifo){unifo={}}HiydSdk.getUserInfo(function(data){if(!data){return}for(var i in data){unifo[i]=data[i];if(i=="birthday"){var curDate=new Date;var birthDate=new Date(data[i]);unifo["age"]=curDate.getFullYear()-birthDate.getFullYear()}}localStorage.setItem("unifo",JSON.stringify(unifo))})}function _initNetworkType(){if(checkWXAgent()){post("/weixin/getJsSign",{url:location.href},function(ret){if(ret.data){ret.data.debug=false;ret.data.jsApiList=["getNetworkType"];wx.config(ret.data);wx.ready(function(){wx.getNetworkType({success:function(res){BDY.wxNetworkType=res.networkType}})})}})}}if(/test\.|new\./.test(location.href)){}else{window.onerror=_reportError}init()});